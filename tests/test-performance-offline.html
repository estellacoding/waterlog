<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•ˆèƒ½èˆ‡é›¢ç·šåŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0984e3;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #0984e3;
            padding-bottom: 10px;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #0984e3;
        }
        .success {
            border-left-color: #00b894;
            background: #e8f8f5;
        }
        .warning {
            border-left-color: #fdcb6e;
            background: #fef9e7;
        }
        .error {
            border-left-color: #d63031;
            background: #ffeaa7;
        }
        pre {
            background: #2d3436;
            color: #dfe6e9;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }
        .online {
            background: #00b894;
            color: white;
        }
        .offline {
            background: #d63031;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ•ˆèƒ½èˆ‡é›¢ç·šåŠŸèƒ½æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>1. ç€è¦½å™¨ç›¸å®¹æ€§æª¢æ¸¬</h2>
        <button onclick="testBrowserCompatibility()">åŸ·è¡Œç›¸å®¹æ€§æª¢æ¸¬</button>
        <div id="compatibility-result"></div>
    </div>

    <div class="test-section">
        <h2>2. æ•ˆèƒ½ç›£æ§æ¸¬è©¦</h2>
        <button onclick="testPerformanceMonitor()">æ¸¬è©¦æ•ˆèƒ½ç›£æ§</button>
        <button onclick="testLoadingIndicator()">æ¸¬è©¦è¼‰å…¥æŒ‡ç¤ºå™¨</button>
        <button onclick="testOperationMeasurement()">æ¸¬è©¦æ“ä½œè¨ˆæ™‚</button>
        <div id="performance-result"></div>
    </div>

    <div class="test-section">
        <h2>3. é›¢ç·šåŠŸèƒ½æ¸¬è©¦</h2>
        <p>ç›®å‰ç‹€æ…‹: <span id="online-status" class="status-badge">æª¢æ¸¬ä¸­...</span></p>
        <button onclick="testOfflineManager()">æ¸¬è©¦é›¢ç·šç®¡ç†</button>
        <button onclick="simulateOffline()">æ¨¡æ“¬é›¢ç·š</button>
        <button onclick="simulateOnline()">æ¨¡æ“¬ä¸Šç·š</button>
        <button onclick="testPendingOperations()">æ¸¬è©¦å¾…è™•ç†æ“ä½œ</button>
        <div id="offline-result"></div>
    </div>

    <div class="test-section">
        <h2>4. DOM å„ªåŒ–æ¸¬è©¦</h2>
        <button onclick="testDOMOptimizer()">æ¸¬è©¦ DOM å„ªåŒ–</button>
        <button onclick="testBatchUpdate()">æ¸¬è©¦æ‰¹æ¬¡æ›´æ–°</button>
        <button onclick="testThrottle()">æ¸¬è©¦ç¯€æµ</button>
        <div id="dom-result"></div>
    </div>

    <div class="test-section">
        <h2>5. æ•¸æ“šå¿«å–æ¸¬è©¦</h2>
        <button onclick="testDataCache()">æ¸¬è©¦æ•¸æ“šå¿«å–</button>
        <button onclick="testCacheExpiration()">æ¸¬è©¦å¿«å–éæœŸ</button>
        <div id="cache-result"></div>
    </div>

    <script src="script.js"></script>
    <script>
        // ç­‰å¾… DOM è¼‰å…¥å®Œæˆ
        window.addEventListener('load', () => {
            updateOnlineStatus();
            
            // ç›£è½ç·šä¸Š/é›¢ç·šç‹€æ…‹è®ŠåŒ–
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        });

        function updateOnlineStatus() {
            const statusEl = document.getElementById('online-status');
            if (navigator.onLine) {
                statusEl.textContent = 'ç·šä¸Š';
                statusEl.className = 'status-badge online';
            } else {
                statusEl.textContent = 'é›¢ç·š';
                statusEl.className = 'status-badge offline';
            }
        }

        function showResult(elementId, content, type = 'result') {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="${type}">${content}</div>`;
        }

        // 1. ç€è¦½å™¨ç›¸å®¹æ€§æ¸¬è©¦
        function testBrowserCompatibility() {
            if (!browserCompatibility) {
                showResult('compatibility-result', 'âŒ BrowserCompatibility æœªåˆå§‹åŒ–', 'error');
                return;
            }

            const features = browserCompatibility.features;
            const browser = browserCompatibility.browser;
            
            let html = `
                <h3>ç€è¦½å™¨è³‡è¨Š</h3>
                <p><strong>åç¨±:</strong> ${browser.name}</p>
                <p><strong>ç‰ˆæœ¬:</strong> ${browser.version}</p>
                <p><strong>æ”¯æ´ç‹€æ…‹:</strong> ${browser.isSupported ? 'âœ… æ”¯æ´' : 'âŒ ä¸æ”¯æ´'}</p>
                
                <h3>åŠŸèƒ½æ”¯æ´</h3>
                <ul>
                    ${Object.entries(features).map(([key, value]) => 
                        `<li><strong>${key}:</strong> ${value ? 'âœ…' : 'âŒ'}</li>`
                    ).join('')}
                </ul>
            `;

            showResult('compatibility-result', html, browser.isSupported ? 'success' : 'warning');
        }

        // 2. æ•ˆèƒ½ç›£æ§æ¸¬è©¦
        function testPerformanceMonitor() {
            const monitor = new PerformanceMonitor();
            monitor.initialize();
            
            const report = monitor.getPerformanceReport();
            
            let html = `
                <h3>æ•ˆèƒ½å ±å‘Š</h3>
                <pre>${JSON.stringify(report, null, 2)}</pre>
            `;
            
            showResult('performance-result', html, 'success');
        }

        function testLoadingIndicator() {
            const monitor = new PerformanceMonitor();
            monitor.showLoadingIndicator('æ¸¬è©¦è¼‰å…¥ä¸­...');
            
            setTimeout(() => {
                monitor.hideLoadingIndicator();
                showResult('performance-result', 'âœ… è¼‰å…¥æŒ‡ç¤ºå™¨æ¸¬è©¦å®Œæˆ', 'success');
            }, 2000);
        }

        function testOperationMeasurement() {
            const monitor = new PerformanceMonitor();
            
            // æ¸¬è©¦ä¸€å€‹ç°¡å–®æ“ä½œ
            const result = monitor.measureOperation('æ¸¬è©¦æ“ä½œ', () => {
                let sum = 0;
                for (let i = 0; i < 1000000; i++) {
                    sum += i;
                }
                return sum;
            });
            
            const lastOp = monitor.metrics.operations[monitor.metrics.operations.length - 1];
            
            showResult('performance-result', 
                `âœ… æ“ä½œå®Œæˆ<br>åŸ·è¡Œæ™‚é–“: ${lastOp.duration.toFixed(2)}ms<br>çµæœ: ${result}`, 
                'success');
        }

        // 3. é›¢ç·šåŠŸèƒ½æ¸¬è©¦
        function testOfflineManager() {
            if (!offlineManager) {
                showResult('offline-result', 'âŒ OfflineManager æœªåˆå§‹åŒ–', 'error');
                return;
            }

            const isOnline = offlineManager.checkOnlineStatus();
            const pendingCount = offlineManager.getPendingCount();
            
            let html = `
                <h3>é›¢ç·šç®¡ç†ç‹€æ…‹</h3>
                <p><strong>ç·šä¸Šç‹€æ…‹:</strong> ${isOnline ? 'âœ… ç·šä¸Š' : 'âš ï¸ é›¢ç·š'}</p>
                <p><strong>å¾…è™•ç†æ“ä½œ:</strong> ${pendingCount} å€‹</p>
                <p><strong>åŒæ­¥é€²è¡Œä¸­:</strong> ${offlineManager.syncInProgress ? 'æ˜¯' : 'å¦'}</p>
            `;
            
            showResult('offline-result', html, isOnline ? 'success' : 'warning');
        }

        function simulateOffline() {
            showResult('offline-result', 'âš ï¸ è«‹ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·åˆ‡æ›åˆ°é›¢ç·šæ¨¡å¼', 'warning');
        }

        function simulateOnline() {
            showResult('offline-result', 'âœ… è«‹ä½¿ç”¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·åˆ‡æ›åˆ°ç·šä¸Šæ¨¡å¼', 'success');
        }

        function testPendingOperations() {
            if (!offlineManager) {
                showResult('offline-result', 'âŒ OfflineManager æœªåˆå§‹åŒ–', 'error');
                return;
            }

            // æ·»åŠ æ¸¬è©¦æ“ä½œ
            offlineManager.addPendingOperation({
                type: 'test',
                data: { message: 'æ¸¬è©¦æ“ä½œ', timestamp: Date.now() }
            });

            const count = offlineManager.getPendingCount();
            showResult('offline-result', 
                `âœ… å·²æ·»åŠ æ¸¬è©¦æ“ä½œ<br>å¾…è™•ç†æ“ä½œæ•¸: ${count}`, 
                'success');
        }

        // 4. DOM å„ªåŒ–æ¸¬è©¦
        function testDOMOptimizer() {
            const optimizer = new DOMOptimizer();
            
            let html = `
                <h3>DOM å„ªåŒ–å·¥å…·</h3>
                <p>âœ… DOMOptimizer å·²å‰µå»º</p>
                <p><strong>å¿«å–å¤§å°:</strong> ${optimizer.cache.size}</p>
            `;
            
            showResult('dom-result', html, 'success');
        }

        function testBatchUpdate() {
            const optimizer = new DOMOptimizer();
            const startTime = performance.now();
            
            // æ‰¹æ¬¡æ›´æ–°æ¸¬è©¦
            for (let i = 0; i < 100; i++) {
                optimizer.batchUpdate(() => {
                    // æ¨¡æ“¬ DOM æ›´æ–°
                });
            }
            
            const endTime = performance.now();
            
            showResult('dom-result', 
                `âœ… æ‰¹æ¬¡æ›´æ–°æ¸¬è©¦å®Œæˆ<br>åŸ·è¡Œæ™‚é–“: ${(endTime - startTime).toFixed(2)}ms`, 
                'success');
        }

        function testThrottle() {
            const optimizer = new DOMOptimizer();
            let callCount = 0;
            
            const throttled = optimizer.throttle(() => {
                callCount++;
            }, 100);
            
            // å¿«é€Ÿå‘¼å«å¤šæ¬¡
            for (let i = 0; i < 10; i++) {
                throttled();
            }
            
            setTimeout(() => {
                showResult('dom-result', 
                    `âœ… ç¯€æµæ¸¬è©¦å®Œæˆ<br>å‘¼å«æ¬¡æ•¸: ${callCount} (æ‡‰è©²åªæœ‰ 1-2 æ¬¡)`, 
                    'success');
            }, 200);
        }

        // 5. æ•¸æ“šå¿«å–æ¸¬è©¦
        function testDataCache() {
            const cache = new DataCache(10, 5000);
            
            // è¨­å®šä¸€äº›æ¸¬è©¦æ•¸æ“š
            cache.set('test1', { data: 'value1' });
            cache.set('test2', { data: 'value2' });
            cache.set('test3', { data: 'value3' });
            
            const value1 = cache.get('test1');
            const value2 = cache.get('test2');
            
            let html = `
                <h3>æ•¸æ“šå¿«å–æ¸¬è©¦</h3>
                <p>âœ… å¿«å–å·²å‰µå»º</p>
                <p><strong>å¿«å–å¤§å°:</strong> ${cache.size()}</p>
                <p><strong>æ¸¬è©¦æ•¸æ“š 1:</strong> ${JSON.stringify(value1)}</p>
                <p><strong>æ¸¬è©¦æ•¸æ“š 2:</strong> ${JSON.stringify(value2)}</p>
            `;
            
            showResult('cache-result', html, 'success');
        }

        function testCacheExpiration() {
            const cache = new DataCache(10, 1000); // 1ç§’éæœŸ
            
            cache.set('expiring', { data: 'will expire' });
            
            showResult('cache-result', 'â³ ç­‰å¾…å¿«å–éæœŸ (1ç§’)...', 'warning');
            
            setTimeout(() => {
                const value = cache.get('expiring');
                
                let html = `
                    <h3>å¿«å–éæœŸæ¸¬è©¦</h3>
                    <p><strong>1ç§’å¾Œçš„å€¼:</strong> ${value === null ? 'âœ… å·²éæœŸ (null)' : 'âŒ æœªéæœŸ'}</p>
                `;
                
                showResult('cache-result', html, value === null ? 'success' : 'error');
            }, 1500);
        }
    </script>
</body>
</html>
